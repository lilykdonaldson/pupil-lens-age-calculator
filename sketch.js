/*
JS code is based off paper "Calculation of Visual and Circadian Response to Light Spectral Distribution" (Zhang, 2009)
with aim to estimate the effects of age and pupil size on the spectral distribution of light reaching the eye using 
several recent pupil size estimation models including the Rea and Ouellette modified De Groot Model and Berman's Model.  

-----INPUTS------
○ 400-700 UserSPD / comma delimited to JSlibrary
○ Illuminance Level (lux) / float
○ Age / int
○ Pupil Diameter (fixed pupil size mode) / float
-----OUTPUTS-----
○ Pupil Diameter (Berman Model) / float
○ Pupil Diameter (Rea Model) / float
○ Table Output: Wavelength, Radiation, Transmittance, Ratio to 20yr&2mm, Radiation at retina / dom table
○ Graph Human Lens Transmittance / chart.js
○ Graph SPD reaching the eye and retina / chart.js
*/
var userSpectrum; //= {400:2,410:2,420:2,430:2,440:2,450:3,460:2,470:4,480:44.0955,490:2,500:59.807,510:1,520:63.9805,530:21,540:260.4295,550:83.4465,560:1,570:124.674,580:121.221,590:221.04,600:301.424,610:2,620:148.5985,630:117.543,640:100.4425,650:92.1615,660:94.376,670:84.31,680:72.869,690:54.5005,700:43.578};
var photopicEfficacy = [0.271833952,0.830603742,2.745797495,7.962812736,15.7883356,26.0850762,41.18696243,62.45316403,95.43019194,142.7951987,221.7231477,345.284035,487.3790554,591.7193602,654.8727026,682.9828731,683.0171269,653.4998038,597.2109552,519.642176,433.1495549,345.284035,261.5372114,181.9090841,120.1286404,73.45008299,41.8734118,21.96637996,11.66963935,5.635749359,2.815815331];
var scotopicEfficacy = [15.67070882,58.76937515,162.9483823,337.0298839,553.4509755,767.5104964,956.4361571,1140.301309,1337.661151,1524.899975,1656.473203,1681.775747,1577.191899,1368.024204,1096.443566,811.3682391,554.6317609,350.1872067,204.4445542,110.4877748,55.91862188,26.87130156,12.43198321,5.625598913,2.525193875,1.141988145,0.527811064,0.249651766,0.120608792,0.059595925,0.030025685];
var userSpectrumText;
var incandescent = {380:0.045322595,382:0.047322255,384:0.049381192,386:0.051500025,388:0.053679346,390:0.055919719,392:0.05822168,394:0.060585736,396:0.063012364,398:0.065502013,400:0.068055099,402:0.070672012,404:0.073353107,406:0.076098712,408:0.078909121,410:0.0817846,412:0.084725381,414:0.087731667,416:0.090803628,418:0.093941404,420:0.097145102,422:0.100414801,424:0.103750545,426:0.10715235,428:0.110620199,430:0.114154046,432:0.117753813,434:0.121419394,436:0.125150651,438:0.128947417,440:0.132809496,442:0.136736661,444:0.14072866,446:0.144785209,448:0.148905997,450:0.153090688,452:0.157338916,454:0.161650289,456:0.166024389,458:0.170460773,460:0.174958971,462:0.17951849,464:0.184138813,466:0.188819398,468:0.19355968,470:0.198359071,472:0.203216964,474:0.208132727,476:0.213105708,478:0.218135236,480:0.223220619,482:0.228361146,484:0.233556089,486:0.238804698,488:0.244106211,490:0.249459845,492:0.254864804,494:0.260320273,496:0.265825426,498:0.271379419,500:0.276981397,502:0.28263049,504:0.288325816,506:0.294066483,508:0.299851584,510:0.305680204,512:0.311551417,514:0.317464288,516:0.323417871,518:0.329411214,520:0.335443355,522:0.341513327,524:0.347620154,526:0.353762854,528:0.359940442,530:0.366151924,532:0.372396304,534:0.37867258,536:0.384979749,538:0.391316802,540:0.397682729,542:0.404076517,544:0.410497153,546:0.41694362,548:0.423414903,550:0.429909985,552:0.436427849,554:0.442967481,556:0.449527864,558:0.456107986,560:0.462706835,562:0.469323402,564:0.475956678,566:0.482605661,568:0.48926935,570:0.495946747,572:0.50263686,574:0.509338699,576:0.516051281,578:0.522773625,580:0.52950476,582:0.536243715,584:0.542989528,586:0.549741244,588:0.556497911,590:0.563258587,592:0.570022336,594:0.576788226,596:0.583555338,598:0.590322756,600:0.597089573,602:0.603854892,604:0.610617822,606:0.61737748,608:0.624132994,610:0.630883499,612:0.637628139,614:0.644366067,616:0.651096446,618:0.657818448,620:0.664531255,622:0.671234057,624:0.677926055,626:0.68460646,628:0.691274492,630:0.697929382,632:0.704570371,634:0.71119671,636:0.71780766,638:0.724402493,640:0.730980491,642:0.737540946,644:0.744083163,646:0.750606454,648:0.757110144,650:0.763593568,652:0.770056073,654:0.776497014,656:0.782915759,658:0.789311687,660:0.795684185,662:0.802032655,664:0.808356506,666:0.814655159,668:0.820928047,670:0.827174613,672:0.83339431,674:0.839586602,676:0.845750965,678:0.851886884,680:0.857993857,682:0.864071388,684:0.870118998,686:0.876136213,688:0.882122572,690:0.888077624,692:0.89400093,694:0.899892058,696:0.905750589,698:0.911576113,700:0.917368232,702:0.923126554,704:0.928850702,706:0.934540306,708:0.940195007,710:0.945814455,712:0.95139831,714:0.956946242,716:0.962457931,718:0.967933065,720:0.973371344,722:0.978772475,724:0.984136175,726:0.989462171,728:0.994750198,730:1};
var daylight = {380:0.424,382:0.432,384:0.44,386:0.448,388:0.456,390:0.464,392:0.511,394:0.559,396:0.607,398:0.654,400:0.702,402:0.717,404:0.732,406:0.747,408:0.761,410:0.776,412:0.78,414:0.783,416:0.786,418:0.79,420:0.793,422:0.781,424:0.77,426:0.759,428:0.747,430:0.736,432:0.767,434:0.797,436:0.828,438:0.859,440:0.89,442:0.911,444:0.931,446:0.952,448:0.973,450:0.993,452:0.995,454:0.996,456:0.997,458:0.999,460:1,462:0.995,464:0.99,466:0.985,468:0.98,470:0.975,472:0.977,474:0.979,476:0.98,478:0.982,480:0.984,482:0.972,484:0.96,486:0.948,488:0.936,490:0.924,492:0.925,494:0.926,496:0.927,498:0.927,500:0.928,502:0.926,504:0.923,506:0.92,508:0.918,510:0.915,512:0.91,514:0.905,516:0.9,518:0.895,520:0.89,522:0.895,524:0.9,526:0.904,528:0.909,530:0.914,532:0.909,534:0.903,536:0.898,538:0.892,540:0.886,542:0.886,544:0.885,546:0.885,548:0.884,550:0.883,552:0.877,554:0.87,556:0.863,558:0.856,560:0.849,562:0.843,564:0.837,566:0.83,568:0.824,570:0.818,572:0.817,574:0.816,576:0.815,578:0.814,580:0.813,582:0.801,584:0.789,586:0.777,588:0.765,590:0.753,592:0.755,594:0.758,596:0.76,598:0.762,600:0.764,602:0.764,604:0.763,606:0.762,608:0.762,610:0.761,612:0.758,614:0.754,616:0.751,618:0.748,620:0.745,622:0.737,624:0.73,626:0.722,628:0.715,630:0.707,632:0.708,634:0.709,636:0.709,638:0.71,640:0.711,642:0.705,644:0.698,646:0.692,648:0.686,650:0.68,652:0.68,654:0.68,656:0.681,658:0.681,660:0.681,662:0.685,664:0.688,666:0.692,668:0.695,670:0.699,672:0.692,674:0.685,676:0.679,678:0.672,680:0.665,682:0.65,684:0.636,686:0.621,688:0.607,690:0.592,692:0.595,694:0.599,696:0.602,698:0.605,700:0.608,702:0.613,704:0.618,706:0.622,708:0.627,710:0.632,712:0.61,714:0.588,716:0.567,718:0.545,720:0.523,722:0.537,724:0.551,726:0.565,728:0.58,730:0.594};
var warmwhitefluorescent = {380:0.57,385:0.7,390:0.87,395:0.98,400:2.01,405:13.75,410:1.95,415:1.59,420:1.76,425:1.93,430:2.1,435:30.28,440:8.03,445:2.55,450:2.7,455:2.82,460:2.91,465:2.99,470:3.04,475:3.08,480:3.09,485:3.09,490:3.14,495:3.06,500:3,505:2.98,510:3.01,515:3.14,520:3.41,525:3.9,530:4.69,535:5.81,540:7.32,545:22.59,550:15.11,555:13.88,560:16.33,565:18.68,570:20.64,575:24.28,580:26.26,585:23.28,590:22.94,595:22.14,600:20.91,605:19.43,610:17.74,615:16,620:14.42,625:12.56,630:10.93,635:9.52,640:8.18,645:7.01,650:6,655:5.11,660:4.36,665:3.69,670:3.13,675:2.64,680:2.24,685:1.91,690:1.7,695:1.39,700:1.18,705:1.03,710:0.88,715:0.74,720:0.64,725:0.54,730:0.49,735:0.46,740:0.42,745:0.37,750:0.37,755:0.33,760:0.35,765:0.36,770:0.31,775:0.26,780:0.19};
var hps = {380:0.0091,381:0.0093,382:0.0094,383:0.0096,384:0.0098,385:0.0099,386:0.0101,387:0.0102,388:0.0103,389:0.0105,390:0.0106,391:0.0108,392:0.0111,393:0.0113,394:0.0116,395:0.0118,396:0.0121,397:0.0123,398:0.0126,399:0.0128,400:0.0131,401:0.0137,402:0.0144,403:0.015,404:0.0156,405:0.0163,406:0.0161,407:0.0159,408:0.0158,409:0.0156,410:0.0154,411:0.0158,412:0.0161,413:0.0165,414:0.0168,415:0.0171,416:0.0176,417:0.018,418:0.0184,419:0.0189,420:0.0193,421:0.0197,422:0.0202,423:0.0206,424:0.0211,425:0.0215,426:0.022,427:0.0224,428:0.0229,429:0.0234,430:0.0238,431:0.0253,432:0.0267,433:0.0282,434:0.0296,435:0.0311,436:0.031,437:0.031,438:0.0309,439:0.0309,440:0.0308,441:0.0301,442:0.0294,443:0.0286,444:0.0279,445:0.0271,446:0.0311,447:0.0352,448:0.0392,449:0.0433,450:0.0473,451:0.0438,452:0.0402,453:0.0367,454:0.0332,455:0.0297,456:0.028,457:0.0263,458:0.0246,459:0.0229,460:0.0212,461:0.0309,462:0.0406,463:0.0502,464:0.0599,465:0.0696,466:0.0679,467:0.0661,468:0.0643,469:0.0625,470:0.0608,471:0.0538,472:0.0469,473:0.04,474:0.0331,475:0.0262,476:0.0228,477:0.0194,478:0.0161,479:0.0127,480:0.0093,481:0.009,482:0.0087,483:0.0083,484:0.008,485:0.0077,486:0.0089,487:0.0101,488:0.0113,489:0.0125,490:0.0137,491:0.0317,492:0.0496,493:0.0676,494:0.0855,495:0.1035,496:0.117,497:0.1305,498:0.1441,499:0.1576,500:0.1711,501:0.1401,502:0.109,503:0.0779,504:0.0468,505:0.0157,506:0.0149,507:0.0141,508:0.0133,509:0.0125,510:0.0116,511:0.0184,512:0.0251,513:0.0318,514:0.0386,515:0.0453,516:0.0392,517:0.0331,518:0.0269,519:0.0208,520:0.0147,521:0.0135,522:0.0124,523:0.0113,524:0.0101,525:0.009,526:0.0092,527:0.0093,528:0.0095,529:0.0097,530:0.0099,531:0.01,532:0.0101,533:0.0102,534:0.0103,535:0.0104,536:0.0108,537:0.0113,538:0.0117,539:0.0121,540:0.0125,541:0.0149,542:0.0172,543:0.0196,544:0.0219,545:0.0243,546:0.0289,547:0.0335,548:0.0381,549:0.0428,550:0.0474,551:0.0504,552:0.0535,553:0.0566,554:0.0597,555:0.0627,556:0.0656,557:0.0685,558:0.0713,559:0.0742,560:0.0771,561:0.1365,562:0.1959,563:0.2553,564:0.3147,565:0.3741,566:0.4538,567:0.5335,568:0.6132,569:0.6929,570:0.7726,571:0.6652,572:0.5578,573:0.4504,574:0.343,575:0.2356,576:0.2766,577:0.3176,578:0.3586,579:0.3995,580:0.4405,581:0.5108,582:0.581,583:0.6513,584:0.7215,585:0.7918,586:0.7211,587:0.6504,588:0.5797,589:0.5089,590:0.4382,591:0.5506,592:0.6629,593:0.7753,594:0.8876,595:1,596:0.9465,597:0.893,598:0.8395,599:0.786,600:0.7325,601:0.6807,602:0.629,603:0.5772,604:0.5254,605:0.4736,606:0.4446,607:0.4155,608:0.3864,609:0.3574,610:0.3283,611:0.3446,612:0.3608,613:0.377,614:0.3932,615:0.4095,616:0.3756,617:0.3416,618:0.3077,619:0.2738,620:0.2399,621:0.2242,622:0.2084,623:0.1927,624:0.177,625:0.1612,626:0.1564,627:0.1516,628:0.1469,629:0.1421,630:0.1373,631:0.1338,632:0.1304,633:0.1269,634:0.1235,635:0.12,636:0.1175,637:0.115,638:0.1125,639:0.11,640:0.1074,641:0.1055,642:0.1036,643:0.1017,644:0.0998,645:0.0978,646:0.0959,647:0.0939,648:0.0919,649:0.0899,650:0.088,651:0.0873,652:0.0865,653:0.0858,654:0.0851,655:0.0844,656:0.0828,657:0.0812,658:0.0796,659:0.078,660:0.0764,661:0.0757,662:0.075,663:0.0744,664:0.0737,665:0.073,666:0.0748,667:0.0765,668:0.0783,669:0.0801,670:0.0819,671:0.081,672:0.08,673:0.0791,674:0.0782,675:0.0772,676:0.0736,677:0.0701,678:0.0665,679:0.0629,680:0.0593,681:0.0563,682:0.0534,683:0.0504,684:0.0474,685:0.0445,686:0.0429,687:0.0413,688:0.0397,689:0.0381,690:0.0365,691:0.0359,692:0.0354,693:0.0349,694:0.0344,695:0.0339,696:0.0339,697:0.0339,698:0.0338,699:0.0338,700:0.0338,701:0.0337,702:0.0337,703:0.0337,704:0.0337,705:0.0337,706:0.0329,707:0.0321,708:0.0314,709:0.0306,710:0.0298,711:0.0296,712:0.0293,713:0.029,714:0.0287,715:0.0284,716:0.0284,717:0.0284,718:0.0283,719:0.0283,720:0.0282,721:0.0279,722:0.0276,723:0.0273,724:0.027,725:0.0266,726:0.0266,727:0.0266,728:0.0265,729:0.0265,730:0.0264,731:0.0265,732:0.0266,733:0.0267,734:0.0268,735:0.0269,736:0.0271,737:0.0272,738:0.0274,739:0.0276,740:0.0277,741:0.028,742:0.0283,743:0.0285,744:0.0288,745:0.0291,746:0.0296,747:0.0302,748:0.0307,749:0.0313,750:0.0319,751:0.0315,752:0.0311,753:0.0308,754:0.0304,755:0.03,756:0.0309,757:0.0318,758:0.0326,759:0.0335,760:0.0343,761:0.0333,762:0.0322,763:0.0312,764:0.0301,765:0.0291,766:0.0296,767:0.0302,768:0.0307,769:0.0313,770:0.0319,771:0.0315,772:0.0311,773:0.0308,774:0.0304,775:0.03,776:0.0309,777:0.0318,778:0.0326,779:0.0335,780:0.0343};
var led2700 = {380:0.0000,381:0.0000,382:0.0000,383:0.0000,384:0.0000,385:0.0000,386:0.0000,387:0.0000,388:0.0000,389:0.0000,390:0.0000,391:0.0000,392:0.0000,393:0.0000,394:0.0000,395:0.0000,396:0.0000,397:0.0000,398:0.0000,399:0.0000,400:0.0000,401:0.0000,402:0.0000,403:0.0001,404:0.0001,405:0.0001,406:0.0005,407:0.0009,408:0.0014,409:0.0018,410:0.0022,411:0.0028,412:0.0033,413:0.0038,414:0.0044,415:0.0049,416:0.0059,417:0.0069,418:0.0079,419:0.0089,420:0.0099,421:0.0128,422:0.0157,423:0.0185,424:0.0214,425:0.0243,426:0.0300,427:0.0358,428:0.0415,429:0.0473,430:0.0530,431:0.0619,432:0.0707,433:0.0796,434:0.0884,435:0.0973,436:0.1115,437:0.1258,438:0.1400,439:0.1542,440:0.1685,441:0.1901,442:0.2117,443:0.2333,444:0.2548,445:0.2764,446:0.2993,447:0.3221,448:0.3450,449:0.3679,450:0.3907,451:0.3893,452:0.3879,453:0.3865,454:0.3850,455:0.3836,456:0.3619,457:0.3401,458:0.3183,459:0.2966,460:0.2748,461:0.2551,462:0.2354,463:0.2158,464:0.1961,465:0.1764,466:0.1702,467:0.1640,468:0.1578,469:0.1516,470:0.1454,471:0.1403,472:0.1352,473:0.1301,474:0.1250,475:0.1199,476:0.1168,477:0.1137,478:0.1106,479:0.1076,480:0.1045,481:0.1045,482:0.1045,483:0.1045,484:0.1046,485:0.1046,486:0.1072,487:0.1099,488:0.1126,489:0.1152,490:0.1179,491:0.1238,492:0.1297,493:0.1355,494:0.1414,495:0.1473,496:0.1569,497:0.1665,498:0.1761,499:0.1858,500:0.1954,501:0.2081,502:0.2209,503:0.2337,504:0.2464,505:0.2592,506:0.2728,507:0.2865,508:0.3002,509:0.3138,510:0.3275,511:0.3388,512:0.3502,513:0.3615,514:0.3728,515:0.3841,516:0.3932,517:0.4022,518:0.4112,519:0.4203,520:0.4293,521:0.4363,522:0.4434,523:0.4504,524:0.4574,525:0.4644,526:0.4684,527:0.4723,528:0.4762,529:0.4802,530:0.4841,531:0.4872,532:0.4902,533:0.4933,534:0.4964,535:0.4994,536:0.5023,537:0.5051,538:0.5079,539:0.5108,540:0.5136,541:0.5166,542:0.5196,543:0.5226,544:0.5255,545:0.5285,546:0.5332,547:0.5379,548:0.5425,549:0.5472,550:0.5519,551:0.5566,552:0.5614,553:0.5661,554:0.5709,555:0.5756,556:0.5818,557:0.5879,558:0.5940,559:0.6001,560:0.6063,561:0.6163,562:0.6264,563:0.6364,564:0.6465,565:0.6565,566:0.6654,567:0.6743,568:0.6831,569:0.6920,570:0.7008,571:0.7108,572:0.7207,573:0.7307,574:0.7406,575:0.7506,576:0.7614,577:0.7722,578:0.7830,579:0.7938,580:0.8046,581:0.8166,582:0.8286,583:0.8406,584:0.8527,585:0.8647,586:0.8737,587:0.8826,588:0.8916,589:0.9006,590:0.9096,591:0.9173,592:0.9251,593:0.9328,594:0.9406,595:0.9483,596:0.9545,597:0.9607,598:0.9669,599:0.9731,600:0.9793,601:0.9830,602:0.9867,603:0.9904,604:0.9942,605:0.9979,606:0.9983,607:0.9987,608:0.9992,609:0.9996,610:1.0000,611:0.9989,612:0.9978,613:0.9968,614:0.9957,615:0.9946,616:0.9911,617:0.9877,618:0.9842,619:0.9807,620:0.9773,621:0.9718,622:0.9664,623:0.9610,624:0.9556,625:0.9502,626:0.9434,627:0.9365,628:0.9297,629:0.9229,630:0.9161,631:0.9073,632:0.8985,633:0.8897,634:0.8810,635:0.8722,636:0.8614,637:0.8507,638:0.8399,639:0.8291,640:0.8184,641:0.8069,642:0.7955,643:0.7840,644:0.7725,645:0.7611,646:0.7493,647:0.7376,648:0.7258,649:0.7141,650:0.7023,651:0.6904,652:0.6785,653:0.6666,654:0.6547,655:0.6428,656:0.6309,657:0.6191,658:0.6073,659:0.5954,660:0.5836,661:0.5718,662:0.5601,663:0.5484,664:0.5366,665:0.5249,666:0.5133,667:0.5017,668:0.4901,669:0.4785,670:0.4669,671:0.4563,672:0.4457,673:0.4352,674:0.4246,675:0.4141,676:0.4049,677:0.3957,678:0.3865,679:0.3773,680:0.3681,681:0.3584,682:0.3488,683:0.3391,684:0.3294,685:0.3198,686:0.3119,687:0.3041,688:0.2962,689:0.2883,690:0.2805,691:0.2736,692:0.2667,693:0.2599,694:0.2530,695:0.2461,696:0.2398,697:0.2334,698:0.2271,699:0.2208,700:0.2145,701:0.2086,702:0.2028,703:0.1970,704:0.1912,705:0.1854,706:0.1801,707:0.1748,708:0.1696,709:0.1643,710:0.1590,711:0.1540,712:0.1490,713:0.1440,714:0.1390,715:0.1339,716:0.1298,717:0.1257,718:0.1216,719:0.1175,720:0.1134,721:0.1105,722:0.1076,723:0.1047,724:0.1018,725:0.0989,726:0.0961,727:0.0933,728:0.0905,729:0.0878,730:0.0850,731:0.0823,732:0.0796,733:0.0769,734:0.0743,735:0.0716,736:0.0696,737:0.0676,738:0.0656,739:0.0636,740:0.0617,741:0.0598,742:0.0579,743:0.0561,744:0.0542,745:0.0523,746:0.0503,747:0.0483,748:0.0462,749:0.0442,750:0.0422,751:0.0406,752:0.0390,753:0.0374,754:0.0358,755:0.0342,756:0.0332,757:0.0321,758:0.0311,759:0.0301,760:0.0290,761:0.0281,762:0.0272,763:0.0263,764:0.0254,765:0.0245,766:0.0237,767:0.0229,768:0.0221,769:0.0213,770:0.0205,771:0.0198,772:0.0192,773:0.0186,774:0.0180,775:0.0174,776:0.0169,777:0.0164,778:0.0159,779:0.0154,780:0.0149};
var led3000 = {380:0.0013,381:0.0013,382:0.0013,383:0.0013,384:0.0013,385:0.0013,386:0.0013,387:0.0013,388:0.0013,389:0.0013,390:0.0013,391:0.0013,392:0.0014,393:0.0015,394:0.0015,395:0.0016,396:0.0016,397:0.0017,398:0.0018,399:0.0018,400:0.0019,401:0.0021,402:0.0023,403:0.0025,404:0.0027,405:0.0028,406:0.0033,407:0.0037,408:0.0042,409:0.0046,410:0.0051,411:0.0061,412:0.0071,413:0.0081,414:0.0091,415:0.0101,416:0.0122,417:0.0143,418:0.0164,419:0.0185,420:0.0205,421:0.0244,422:0.0283,423:0.0321,424:0.0360,425:0.0398,426:0.0464,427:0.0530,428:0.0595,429:0.0661,430:0.0727,431:0.0831,432:0.0934,433:0.1038,434:0.1142,435:0.1245,436:0.1410,437:0.1574,438:0.1738,439:0.1903,440:0.2067,441:0.2319,442:0.2570,443:0.2822,444:0.3073,445:0.3325,446:0.3576,447:0.3827,448:0.4078,449:0.4329,450:0.4580,451:0.4621,452:0.4663,453:0.4705,454:0.4747,455:0.4788,456:0.4621,457:0.4453,458:0.4286,459:0.4118,460:0.3951,461:0.3797,462:0.3644,463:0.3490,464:0.3336,465:0.3183,466:0.3080,467:0.2978,468:0.2876,469:0.2773,470:0.2671,471:0.2583,472:0.2495,473:0.2407,474:0.2319,475:0.2231,476:0.2178,477:0.2125,478:0.2072,479:0.2019,480:0.1966,481:0.1956,482:0.1947,483:0.1937,484:0.1928,485:0.1919,486:0.1939,487:0.1959,488:0.1979,489:0.1999,490:0.2020,491:0.2061,492:0.2103,493:0.2145,494:0.2187,495:0.2228,496:0.2288,497:0.2348,498:0.2408,499:0.2468,500:0.2528,501:0.2599,502:0.2669,503:0.2739,504:0.2809,505:0.2879,506:0.2953,507:0.3027,508:0.3101,509:0.3175,510:0.3249,511:0.3328,512:0.3407,513:0.3486,514:0.3565,515:0.3644,516:0.3729,517:0.3814,518:0.3898,519:0.3983,520:0.4068,521:0.4159,522:0.4250,523:0.4341,524:0.4432,525:0.4523,526:0.4618,527:0.4712,528:0.4807,529:0.4902,530:0.4997,531:0.5096,532:0.5195,533:0.5295,534:0.5394,535:0.5493,536:0.5596,537:0.5698,538:0.5800,539:0.5903,540:0.6005,541:0.6109,542:0.6214,543:0.6318,544:0.6422,545:0.6527,546:0.6632,547:0.6738,548:0.6843,549:0.6949,550:0.7054,551:0.7156,552:0.7258,553:0.7360,554:0.7461,555:0.7563,556:0.7661,557:0.7759,558:0.7857,559:0.7955,560:0.8053,561:0.8145,562:0.8238,563:0.8330,564:0.8422,565:0.8515,566:0.8596,567:0.8678,568:0.8759,569:0.8841,570:0.8922,571:0.8994,572:0.9065,573:0.9137,574:0.9208,575:0.9279,576:0.9338,577:0.9397,578:0.9456,579:0.9515,580:0.9573,581:0.9619,582:0.9664,583:0.9710,584:0.9755,585:0.9801,586:0.9829,587:0.9857,588:0.9884,589:0.9912,590:0.9940,591:0.9952,592:0.9964,593:0.9976,594:0.9988,595:1.0000,596:0.9990,597:0.9980,598:0.9970,599:0.9960,600:0.9949,601:0.9928,602:0.9906,603:0.9885,604:0.9864,605:0.9842,606:0.9808,607:0.9774,608:0.9740,609:0.9705,610:0.9671,611:0.9619,612:0.9566,613:0.9514,614:0.9461,615:0.9409,616:0.9341,617:0.9274,618:0.9206,619:0.9138,620:0.9071,621:0.8996,622:0.8920,623:0.8845,624:0.8770,625:0.8695,626:0.8607,627:0.8519,628:0.8431,629:0.8343,630:0.8255,631:0.8164,632:0.8073,633:0.7982,634:0.7891,635:0.7800,636:0.7703,637:0.7606,638:0.7508,639:0.7411,640:0.7314,641:0.7215,642:0.7116,643:0.7018,644:0.6919,645:0.6821,646:0.6719,647:0.6617,648:0.6515,649:0.6413,650:0.6312,651:0.6211,652:0.6111,653:0.6010,654:0.5910,655:0.5809,656:0.5709,657:0.5608,658:0.5508,659:0.5407,660:0.5307,661:0.5212,662:0.5118,663:0.5024,664:0.4930,665:0.4836,666:0.4747,667:0.4659,668:0.4570,669:0.4482,670:0.4393,671:0.4306,672:0.4219,673:0.4132,674:0.4044,675:0.3957,676:0.3877,677:0.3798,678:0.3718,679:0.3638,680:0.3559,681:0.3486,682:0.3412,683:0.3339,684:0.3266,685:0.3192,686:0.3124,687:0.3056,688:0.2987,689:0.2919,690:0.2851,691:0.2789,692:0.2727,693:0.2665,694:0.2603,695:0.2541,696:0.2484,697:0.2426,698:0.2369,699:0.2311,700:0.2254,701:0.2203,702:0.2152,703:0.2102,704:0.2051,705:0.2001,706:0.1954,707:0.1907,708:0.1860,709:0.1814,710:0.1767,711:0.1726,712:0.1686,713:0.1645,714:0.1605,715:0.1565,716:0.1528,717:0.1492,718:0.1456,719:0.1420,720:0.1384,721:0.1351,722:0.1319,723:0.1286,724:0.1253,725:0.1220,726:0.1190,727:0.1161,728:0.1131,729:0.1101,730:0.1071,731:0.1046,732:0.1020,733:0.0994,734:0.0968,735:0.0942,736:0.0918,737:0.0895,738:0.0872,739:0.0848,740:0.0825,741:0.0805,742:0.0786,743:0.0766,744:0.0747,745:0.0727,746:0.0710,747:0.0693,748:0.0676,749:0.0659,750:0.0642,751:0.0626,752:0.0610,753:0.0594,754:0.0578,755:0.0563,756:0.0549,757:0.0536,758:0.0523,759:0.0509,760:0.0496,761:0.0484,762:0.0472,763:0.0460,764:0.0448,765:0.0436,766:0.0425,767:0.0415,768:0.0404,769:0.0393,770:0.0382,771:0.0373,772:0.0363,773:0.0354,774:0.0345,775:0.0335,776:0.0327,777:0.0319,778:0.0310,779:0.0302,780:0.0294};
var led4000 = {380:0.0023,381:0.0023,382:0.0023,383:0.0023,384:0.0023,385:0.0023,386:0.0023,387:0.0023,388:0.0023,389:0.0023,390:0.0023,391:0.0023,392:0.0023,393:0.0023,394:0.0023,395:0.0023,396:0.0023,397:0.0023,398:0.0023,399:0.0023,400:0.0023,401:0.0025,402:0.0028,403:0.0030,404:0.0032,405:0.0034,406:0.0041,407:0.0048,408:0.0055,409:0.0062,410:0.0069,411:0.0080,412:0.0092,413:0.0103,414:0.0115,415:0.0126,416:0.0152,417:0.0177,418:0.0202,419:0.0228,420:0.0253,421:0.0308,422:0.0363,423:0.0418,424:0.0474,425:0.0529,426:0.0644,427:0.0759,428:0.0874,429:0.0989,430:0.1104,431:0.1322,432:0.1540,433:0.1759,434:0.1977,435:0.2195,436:0.2607,437:0.3018,438:0.3430,439:0.3841,440:0.4253,441:0.4892,442:0.5531,443:0.6170,444:0.6809,445:0.7448,446:0.7945,447:0.8441,448:0.8938,449:0.9435,450:0.9931,451:0.9823,452:0.9715,453:0.9607,454:0.9499,455:0.9391,456:0.8940,457:0.8490,458:0.8039,459:0.7589,460:0.7138,461:0.6761,462:0.6384,463:0.6007,464:0.5630,465:0.5253,466:0.4963,467:0.4674,468:0.4384,469:0.4094,470:0.3805,471:0.3570,472:0.3336,473:0.3101,474:0.2867,475:0.2632,476:0.2497,477:0.2361,478:0.2225,479:0.2090,480:0.1954,481:0.1894,482:0.1835,483:0.1775,484:0.1715,485:0.1655,486:0.1637,487:0.1618,488:0.1600,489:0.1582,490:0.1563,491:0.1582,492:0.1600,493:0.1618,494:0.1637,495:0.1655,496:0.1699,497:0.1743,498:0.1786,499:0.1830,500:0.1874,501:0.1933,502:0.1993,503:0.2053,504:0.2113,505:0.2172,506:0.2246,507:0.2320,508:0.2393,509:0.2467,510:0.2540,511:0.2623,512:0.2706,513:0.2789,514:0.2871,515:0.2954,516:0.3044,517:0.3133,518:0.3223,519:0.3313,520:0.3402,521:0.3506,522:0.3609,523:0.3713,524:0.3816,525:0.3920,526:0.4037,527:0.4154,528:0.4271,529:0.4389,530:0.4506,531:0.4639,532:0.4772,533:0.4906,534:0.5039,535:0.5172,536:0.5320,537:0.5467,538:0.5614,539:0.5761,540:0.5908,541:0.6071,542:0.6235,543:0.6398,544:0.6561,545:0.6724,546:0.6885,547:0.7046,548:0.7207,549:0.7368,550:0.7529,551:0.7690,552:0.7851,553:0.8012,554:0.8172,555:0.8333,556:0.8476,557:0.8618,558:0.8761,559:0.8904,560:0.9046,561:0.9149,562:0.9253,563:0.9356,564:0.9460,565:0.9563,566:0.9628,567:0.9692,568:0.9756,569:0.9821,570:0.9885,571:0.9908,572:0.9931,573:0.9954,574:0.9977,575:1.0000,576:0.9989,577:0.9977,578:0.9966,579:0.9954,580:0.9943,581:0.9897,582:0.9851,583:0.9805,584:0.9759,585:0.9713,586:0.9639,587:0.9566,588:0.9492,589:0.9418,590:0.9345,591:0.9237,592:0.9129,593:0.9021,594:0.8913,595:0.8805,596:0.8676,597:0.8547,598:0.8418,599:0.8290,600:0.8161,601:0.8018,602:0.7876,603:0.7733,604:0.7591,605:0.7448,606:0.7304,607:0.7159,608:0.7014,609:0.6869,610:0.6724,611:0.6579,612:0.6435,613:0.6290,614:0.6145,615:0.6000,616:0.5862,617:0.5724,618:0.5586,619:0.5448,620:0.5310,621:0.5177,622:0.5044,623:0.4910,624:0.4777,625:0.4644,626:0.4522,627:0.4400,628:0.4278,629:0.4156,630:0.4035,631:0.3924,632:0.3814,633:0.3703,634:0.3593,635:0.3483,636:0.3384,637:0.3285,638:0.3186,639:0.3087,640:0.2989,641:0.2901,642:0.2814,643:0.2726,644:0.2639,645:0.2552,646:0.2476,647:0.2400,648:0.2324,649:0.2248,650:0.2172,651:0.2106,652:0.2039,653:0.1972,654:0.1906,655:0.1839,656:0.1782,657:0.1724,658:0.1667,659:0.1609,660:0.1552,661:0.1501,662:0.1451,663:0.1400,664:0.1349,665:0.1299,666:0.1258,667:0.1216,668:0.1175,669:0.1133,670:0.1092,671:0.1058,672:0.1023,673:0.0989,674:0.0954,675:0.0920,676:0.0890,677:0.0860,678:0.0830,679:0.0800,680:0.0770,681:0.0745,682:0.0720,683:0.0694,684:0.0669,685:0.0644,686:0.0623,687:0.0602,688:0.0582,689:0.0561,690:0.0540,691:0.0524,692:0.0508,693:0.0492,694:0.0476,695:0.0460,696:0.0444,697:0.0428,698:0.0411,699:0.0395,700:0.0379,701:0.0368,702:0.0356,703:0.0345,704:0.0333,705:0.0322,706:0.0310,707:0.0299,708:0.0287,709:0.0276,710:0.0264,711:0.0257,712:0.0251,713:0.0244,714:0.0237,715:0.0230,716:0.0221,717:0.0212,718:0.0202,719:0.0193,720:0.0184,721:0.0179,722:0.0175,723:0.0170,724:0.0166,725:0.0161,726:0.0156,727:0.0152,728:0.0147,729:0.0143,730:0.0138,731:0.0133,732:0.0129,733:0.0124,734:0.0120,735:0.0115,736:0.0110,737:0.0106,738:0.0101,739:0.0097,740:0.0092,741:0.0090,742:0.0087,743:0.0085,744:0.0083,745:0.0080,746:0.0078,747:0.0076,748:0.0074,749:0.0071,750:0.0069,751:0.0067,752:0.0064,753:0.0062,754:0.0060,755:0.0057,756:0.0055,757:0.0053,758:0.0051,759:0.0048,760:0.0046,761:0.0046,762:0.0046,763:0.0046,764:0.0046,765:0.0046,766:0.0044,767:0.0041,768:0.0039,769:0.0037,770:0.0034,771:0.0034,772:0.0034,773:0.0034,774:0.0034,775:0.0034,776:0.0032,777:0.0030,778:0.0028,779:0.0025,780:0.0023};
var led6800 = {380:0.0008,381:0.0008,382:0.0008,383:0.0008,384:0.0008,385:0.0008,386:0.0008,387:0.0009,388:0.0009,389:0.0009,390:0.0009,391:0.0011,392:0.0012,393:0.0013,394:0.0014,395:0.0015,396:0.0017,397:0.0018,398:0.0019,399:0.0020,400:0.0021,401:0.0024,402:0.0026,403:0.0029,404:0.0032,405:0.0034,406:0.0038,407:0.0043,408:0.0047,409:0.0051,410:0.0056,411:0.0064,412:0.0072,413:0.0080,414:0.0088,415:0.0096,416:0.0110,417:0.0124,418:0.0139,419:0.0153,420:0.0168,421:0.0194,422:0.0220,423:0.0247,424:0.0273,425:0.0300,426:0.0345,427:0.0389,428:0.0434,429:0.0479,430:0.0524,431:0.0600,432:0.0677,433:0.0753,434:0.0829,435:0.0905,436:0.1031,437:0.1156,438:0.1282,439:0.1407,440:0.1533,441:0.1742,442:0.1952,443:0.2161,444:0.2370,445:0.2580,446:0.2910,447:0.3241,448:0.3571,449:0.3902,450:0.4232,451:0.4691,452:0.5149,453:0.5608,454:0.6066,455:0.6525,456:0.6998,457:0.7471,458:0.7944,459:0.8416,460:0.8889,461:0.9112,462:0.9334,463:0.9556,464:0.9778,465:1.0000,466:0.9817,467:0.9634,468:0.9451,469:0.9269,470:0.9086,471:0.8699,472:0.8312,473:0.7925,474:0.7538,475:0.7151,476:0.6835,477:0.6519,478:0.6203,479:0.5888,480:0.5572,481:0.5349,482:0.5127,483:0.4905,484:0.4683,485:0.4461,486:0.4287,487:0.4113,488:0.3939,489:0.3765,490:0.3592,491:0.3463,492:0.3334,493:0.3205,494:0.3077,495:0.2948,496:0.2879,497:0.2810,498:0.2741,499:0.2672,500:0.2603,501:0.2584,502:0.2565,503:0.2547,504:0.2528,505:0.2509,506:0.2521,507:0.2533,508:0.2546,509:0.2558,510:0.2570,511:0.2614,512:0.2657,513:0.2701,514:0.2744,515:0.2787,516:0.2843,517:0.2899,518:0.2955,519:0.3011,520:0.3067,521:0.3127,522:0.3187,523:0.3246,524:0.3306,525:0.3366,526:0.3421,527:0.3476,528:0.3531,529:0.3587,530:0.3642,531:0.3691,532:0.3740,533:0.3789,534:0.3838,535:0.3888,536:0.3925,537:0.3962,538:0.3999,539:0.4036,540:0.4074,541:0.4098,542:0.4122,543:0.4147,544:0.4171,545:0.4195,546:0.4215,547:0.4235,548:0.4255,549:0.4275,550:0.4295,551:0.4306,552:0.4317,553:0.4327,554:0.4338,555:0.4349,556:0.4352,557:0.4356,558:0.4359,559:0.4362,560:0.4365,561:0.4362,562:0.4359,563:0.4356,564:0.4353,565:0.4350,566:0.4345,567:0.4341,568:0.4336,569:0.4332,570:0.4327,571:0.4313,572:0.4299,573:0.4286,574:0.4272,575:0.4258,576:0.4246,577:0.4234,578:0.4221,579:0.4209,580:0.4197,581:0.4179,582:0.4161,583:0.4143,584:0.4125,585:0.4107,586:0.4080,587:0.4053,588:0.4026,589:0.3999,590:0.3972,591:0.3943,592:0.3913,593:0.3884,594:0.3855,595:0.3825,596:0.3799,597:0.3773,598:0.3747,599:0.3720,600:0.3694,601:0.3659,602:0.3623,603:0.3588,604:0.3553,605:0.3517,606:0.3482,607:0.3446,608:0.3411,609:0.3375,610:0.3339,611:0.3299,612:0.3258,613:0.3218,614:0.3177,615:0.3137,616:0.3099,617:0.3062,618:0.3024,619:0.2987,620:0.2950,621:0.2908,622:0.2866,623:0.2824,624:0.2782,625:0.2741,626:0.2705,627:0.2669,628:0.2633,629:0.2597,630:0.2561,631:0.2523,632:0.2486,633:0.2448,634:0.2411,635:0.2374,636:0.2335,637:0.2297,638:0.2259,639:0.2221,640:0.2182,641:0.2146,642:0.2110,643:0.2073,644:0.2037,645:0.2001,646:0.1963,647:0.1926,648:0.1888,649:0.1850,650:0.1813,651:0.1779,652:0.1745,653:0.1711,654:0.1678,655:0.1644,656:0.1610,657:0.1577,658:0.1544,659:0.1510,660:0.1477,661:0.1444,662:0.1412,663:0.1380,664:0.1347,665:0.1315,666:0.1283,667:0.1251,668:0.1219,669:0.1187,670:0.1155,671:0.1130,672:0.1105,673:0.1080,674:0.1055,675:0.1030,676:0.1008,677:0.0985,678:0.0963,679:0.0941,680:0.0918,681:0.0895,682:0.0873,683:0.0850,684:0.0827,685:0.0804,686:0.0786,687:0.0767,688:0.0748,689:0.0729,690:0.0711,691:0.0695,692:0.0679,693:0.0663,694:0.0648,695:0.0632,696:0.0617,697:0.0601,698:0.0586,699:0.0571,700:0.0555,701:0.0543,702:0.0531,703:0.0519,704:0.0506,705:0.0494,706:0.0482,707:0.0471,708:0.0459,709:0.0447,710:0.0436,711:0.0425,712:0.0415,713:0.0404,714:0.0394,715:0.0383,716:0.0374,717:0.0364,718:0.0354,719:0.0344,720:0.0334,721:0.0326,722:0.0319,723:0.0311,724:0.0303,725:0.0295,726:0.0288,727:0.0281,728:0.0274,729:0.0267,730:0.0260,731:0.0253,732:0.0246,733:0.0240,734:0.0233,735:0.0226,736:0.0221,737:0.0216,738:0.0212,739:0.0207,740:0.0202,741:0.0197,742:0.0192,743:0.0187,744:0.0181,745:0.0176,746:0.0172,747:0.0168,748:0.0164,749:0.0160,750:0.0156,751:0.0152,752:0.0148,753:0.0144,754:0.0139,755:0.0135,756:0.0132,757:0.0128,758:0.0125,759:0.0121,760:0.0118,761:0.0115,762:0.0112,763:0.0109,764:0.0106,765:0.0103,766:0.0100,767:0.0098,768:0.0096,769:0.0093,770:0.0091,771:0.0089,772:0.0087,773:0.0084,774:0.0082,775:0.0080,776:0.0078,777:0.0076,778:0.0075,779:0.0073,780:0.0071};
var metalhalide = {380:0.0638,381:0.0735,382:0.0832,383:0.0929,384:0.1027,385:0.1124,386:0.1218,387:0.1312,388:0.1406,389:0.15,390:0.1594,391:0.1705,392:0.1816,393:0.1927,394:0.2037,395:0.2148,396:0.2155,397:0.2162,398:0.2169,399:0.2177,400:0.2184,401:0.2255,402:0.2327,403:0.2398,404:0.247,405:0.2542,406:0.2647,407:0.2753,408:0.2859,409:0.2964,410:0.307,411:0.3206,412:0.3341,413:0.3477,414:0.3612,415:0.3748,416:0.3819,417:0.3889,418:0.396,419:0.4031,420:0.4101,421:0.4112,422:0.4122,423:0.4133,424:0.4143,425:0.4153,426:0.4053,427:0.3952,428:0.3852,429:0.3751,430:0.3651,431:0.3684,432:0.3717,433:0.375,434:0.3783,435:0.3816,436:0.3734,437:0.3653,438:0.3572,439:0.3491,440:0.3409,441:0.3425,442:0.344,443:0.3456,444:0.3471,445:0.3487,446:0.339,447:0.3293,448:0.3196,449:0.3099,450:0.3002,451:0.3056,452:0.311,453:0.3163,454:0.3217,455:0.3271,456:0.3347,457:0.3423,458:0.3498,459:0.3574,460:0.365,461:0.3616,462:0.3582,463:0.3548,464:0.3514,465:0.348,466:0.3459,467:0.3438,468:0.3417,469:0.3396,470:0.3375,471:0.3354,472:0.3332,473:0.331,474:0.3289,475:0.3267,476:0.3246,477:0.3225,478:0.3204,479:0.3183,480:0.3162,481:0.3112,482:0.3061,483:0.3011,484:0.2961,485:0.2911,486:0.2948,487:0.2985,488:0.3021,489:0.3058,490:0.3095,491:0.312,492:0.3144,493:0.3168,494:0.3193,495:0.3217,496:0.3251,497:0.3284,498:0.3318,499:0.3351,500:0.3385,501:0.3493,502:0.3602,503:0.3711,504:0.382,505:0.3929,506:0.3839,507:0.3749,508:0.3659,509:0.3569,510:0.3479,511:0.348,512:0.3482,513:0.3483,514:0.3485,515:0.3486,516:0.3482,517:0.3478,518:0.3474,519:0.3469,520:0.3465,521:0.3483,522:0.3501,523:0.3519,524:0.3537,525:0.3555,526:0.37,527:0.3845,528:0.399,529:0.4135,530:0.428,531:0.5424,532:0.6568,533:0.7712,534:0.8856,535:1,536:0.9705,537:0.9409,538:0.9114,539:0.8818,540:0.8523,541:0.7863,542:0.7204,543:0.6544,544:0.5885,545:0.5226,546:0.4951,547:0.4677,548:0.4402,549:0.4128,550:0.3854,551:0.3808,552:0.3763,553:0.3718,554:0.3672,555:0.3627,556:0.3739,557:0.3851,558:0.3963,559:0.4075,560:0.4188,561:0.4302,562:0.4417,563:0.4532,564:0.4646,565:0.4761,566:0.4766,567:0.4771,568:0.4775,569:0.478,570:0.4785,571:0.474,572:0.4695,573:0.465,574:0.4605,575:0.4561,576:0.4497,577:0.4432,578:0.4368,579:0.4304,580:0.424,581:0.437,582:0.4499,583:0.4629,584:0.4758,585:0.4888,586:0.539,587:0.5893,588:0.6396,589:0.6898,590:0.7401,591:0.7552,592:0.7703,593:0.7854,594:0.8005,595:0.8156,596:0.7829,597:0.7502,598:0.7175,599:0.6849,600:0.6522,601:0.6269,602:0.6016,603:0.5763,604:0.5511,605:0.5258,606:0.5295,607:0.5333,608:0.5371,609:0.5408,610:0.5446,611:0.5501,612:0.5556,613:0.5611,614:0.5667,615:0.5722,616:0.5525,617:0.5328,618:0.513,619:0.4933,620:0.4736,621:0.4826,622:0.4916,623:0.5005,624:0.5095,625:0.5185,626:0.5204,627:0.5223,628:0.5242,629:0.5261,630:0.528,631:0.5279,632:0.5278,633:0.5277,634:0.5276,635:0.5275,636:0.5315,637:0.5356,638:0.5397,639:0.5438,640:0.5478,641:0.5481,642:0.5483,643:0.5486,644:0.5488,645:0.5491,646:0.5257,647:0.5022,648:0.4788,649:0.4554,650:0.432,651:0.4289,652:0.4258,653:0.4227,654:0.4196,655:0.4165,656:0.4195,657:0.4226,658:0.4256,659:0.4287,660:0.4317,661:0.4208,662:0.41,663:0.3991,664:0.3883,665:0.3774,666:0.3718,667:0.3662,668:0.3606,669:0.355,670:0.3494,671:0.347,672:0.3445,673:0.3421,674:0.3397,675:0.3372,676:0.3375,677:0.3378,678:0.3381,679:0.3384,680:0.3386,681:0.3442,682:0.3499,683:0.3555,684:0.3611,685:0.3667,686:0.3463,687:0.3258,688:0.3054,689:0.2849,690:0.2645,691:0.2667,692:0.2689,693:0.2712,694:0.2734,695:0.2756,696:0.2679,697:0.2602,698:0.2525,699:0.2448,700:0.2371,701:0.2289,702:0.2206,703:0.2123,704:0.2041,705:0.1958,706:0.192,707:0.1881,708:0.1842,709:0.1804,710:0.1765,711:0.1767,712:0.1768,713:0.177,714:0.1771,715:0.1772,716:0.1759,717:0.1746,718:0.1733,719:0.172,720:0.1707,721:0.1681,722:0.1656,723:0.1631,724:0.1605,725:0.158,726:0.1555,727:0.153,728:0.1506,729:0.1481,730:0.1456,731:0.1446,732:0.1435,733:0.1425,734:0.1414,735:0.1404,736:0.1415,737:0.1425,738:0.1436,739:0.1447,740:0.1458,741:0.145,742:0.1442,743:0.1434,744:0.1426,745:0.1418,746:0.1453,747:0.1489,748:0.1524,749:0.1559,750:0.1595,751:0.1753,752:0.1912,753:0.2071,754:0.2229,755:0.2388,756:0.2249,757:0.211,758:0.1972,759:0.1833,760:0.1694,761:0.1639,762:0.1584,763:0.1529,764:0.1473,765:0.1418,766:0.1453,767:0.1489,768:0.1524,769:0.1559,770:0.1595,771:0.1753,772:0.1912,773:0.2071,774:0.2229,775:0.2388,776:0.2249,777:0.211,778:0.1972,779:0.1833,780:0.1694};

//age20
var twentyPupilSize0 = [5.623,14.005,22.387,36.253,50.119,53.176,56.234,58.000,59.451,60.408,62.000,62.183,63.001,63.772,64.497,65.000,65.808,66.394,66.933,67.426,68.000,68.272,68.626,68.933,69.194,69.408,69.576,69.698,69.773,69.801,70.000];
var twentyPupilSize2 = [5.623,14.005,22.387,36.253,50.119,53.176,56.234,58.000,59.451,60.408,62.000,62.183,63.001,63.772,64.497,65.000,65.808,66.394,66.933,67.426,68.000,68.272,68.626,68.933,69.194,69.408,69.576,69.698,69.773,69.801,70.000];
var twentyPupilSize4 = [6.310,15.714,25.119,37.619,50.119,53.176,56.234,58.000,59.451,60.408,62.000,62.183,63.001,63.772,64.497,65.000,65.808,66.394,66.933,67.426,68.000,68.272,68.626,68.933,69.194,69.408,69.576,69.698,69.773,69.801,70.000];
var twentyPupilSize6 = [7.943,18.064,28.184,39.151,50.119,53.176,56.234,58.000,59.451,60.408,62.000,62.183,63.001,63.772,64.497,65.000,65.808,66.394,66.933,67.426,68.000,68.272,68.626,68.933,69.194,69.408,69.576,69.698,69.773,69.801,70.000];
var twentyPupilSize8 = [12.59,22.11,31.62,42.05,52.48,54.36,56.23,58.00,59.45,60.41,62.00,62.18,63.00,63.77,64.50,65.00,65.81,66.39,66.93,67.43,68.00,68.27,68.63,68.93,69.19,69.41,69.58,69.70,69.77,69.80,70.00];
//age40
var fourtyPupilSize0 = [1.995,5.998,10.000,20.811,31.623,35.717,39.811,47.500,50.728,53.447,56.000,57.662,59.276,60.632,61.777,62.500,63.592,64.329,64.991,65.596,66.500,66.698,67.210,67.699,68.159,68.500,68.951,69.247,69.445,69.513,69.600];
var fourtyPupilSize2 = [1.995,5.998,10.000,20.811,31.623,35.717,39.811,47.500,50.728,53.447,56.000,57.662,59.276,60.632,61.777,62.500,63.592,64.329,64.991,65.596,66.500,66.698,67.210,67.699,68.159,68.500,68.951,69.247,69.445,69.513,69.600];
var fourtyPupilSize4 = [2.512,7.551,12.589,22.106,31.623,35.717,39.811,47.500,50.728,53.447,56.000,57.662,59.276,60.632,61.777,62.500,63.592,64.329,64.991,65.596,66.500,66.698,67.210,67.699,68.159,68.500,68.951,69.247,69.445,69.513,69.600];
var fourtyPupilSize6 = [3.162,9.506,15.849,23.736,31.623,37.140,42.658,47.500,50.728,53.447,56.000,57.662,59.276,60.632,61.777,62.500,63.592,64.329,64.991,65.596,66.500,66.698,67.210,67.699,68.159,68.500,68.951,69.247,69.445,69.513,69.600];
var fourtyPupilSize8 = [5.012,12.482,19.953,29.882,39.811,42.240,44.668,47.500,50.728,53.447,56.000,57.662,59.276,60.632,61.777,62.500,63.592,64.329,64.991,65.596,66.500,66.698,67.210,67.699,68.159,68.500,68.951,69.247,69.445,69.513,69.600];
//age60
var sixtyPupilSize0 = [0.562,3.093,5.623,11.703,17.783,20.085,22.387,36.000,40.312,44.105,47.500,50.395,52.989,55.274,57.290,59.000,60.649,62.053,63.304,64.425,65.500,66.332,67.141,67.860,68.490,69.000,69.200,69.400,69.600,69.800,70.000];
var sixtyPupilSize2 = [0.562,3.093,5.623,11.703,17.783,20.085,22.387,36.000,40.312,44.105,47.500,50.395,52.989,55.274,57.290,59.000,60.649,62.053,63.304,64.425,65.500,66.332,67.141,67.860,68.490,69.000,69.200,69.400,69.600,69.800,70.000];
var sixtyPupilSize4 = [0.708,3.509,6.310,12.046,17.783,20.085,22.387,36.000,40.312,44.105,47.500,50.395,52.989,55.274,57.290,59.000,60.649,62.053,63.304,64.425,65.500,66.332,67.141,67.860,68.490,69.000,69.200,69.400,69.600,69.800,70.000];
var sixtyPupilSize6 = [1.000,4.472,7.943,13.948,19.953,22.536,25.119,36.000,40.312,44.105,47.500,50.395,52.989,55.274,57.290,59.000,60.649,62.053,63.304,64.425,65.500,66.332,67.141,67.860,68.490,69.000,69.200,69.400,69.600,69.800,70.000];
var sixtyPupilSize8 = [1.778,5.889,10.000,17.559,25.119,28.371,31.623,36.000,40.312,44.105,47.500,50.395,52.989,55.274,57.290,59.000,60.649,62.053,63.304,64.425,65.500,66.332,67.141,67.860,68.490,69.000,69.200,69.400,69.600,69.800,70.000];
//age80
var eightyPupilSize0 = [0.100,1.048,1.995,4.152,6.310,8.155,10.000,25.000,28.569,31.772,35.000,37.730,40.486,43.093,45.551,48.000,50.021,52.033,53.897,55.611,57.500,58.594,59.862,60.981,61.952,62.774,63.447,63.971,64.347,64.574,65.000];
var eightyPupilSize2 = [0.112,1.175,2.239,4.274,6.310,8.155,10.000,25.000,28.569,31.772,35.000,37.730,40.486,43.093,45.551,48.000,50.021,52.033,53.897,55.611,57.500,58.594,59.862,60.981,61.952,62.774,63.447,63.971,64.347,64.574,65.000];
var eightyPupilSize4 = [0.126,1.319,2.512,4.796,7.079,9.150,11.220,25.000,28.569,31.772,35.000,37.730,40.486,43.093,45.551,48.000,50.021,52.033,53.897,55.611,57.500,58.594,59.862,60.981,61.952,62.774,63.447,63.971,64.347,64.574,65.000];
var eightyPupilSize6 = [0.200,1.681,3.162,6.037,8.913,11.519,14.125,25.000,28.569,31.772,35.000,37.730,40.486,43.093,45.551,48.000,50.021,52.033,53.897,55.611,57.500,58.594,59.862,60.981,61.952,62.774,63.447,63.971,64.347,64.574,65.000];
var eightyPupilSize8 = [0.562,2.272,3.981,7.601,11.220,14.501,17.783,25.000,28.569,31.772,35.000,37.730,40.486,43.093,45.551,48.000,50.021,52.033,53.897,55.611,57.500,58.594,59.862,60.981,61.952,62.774,63.447,63.971,64.347,64.574,65.000];

var wavelengthSpectrum;
var valuesSpectrumReachingRetina;

//wavelength,Vlamda,SPDxVlamda,PhotopicSPD,ScotopicSPD
var SPcalculations;
var illuminanceLevel;
var luminance;
var ReaOuelletteModifiedDeGroot;
var BermanModel;
//3
var scotopicSum;
var photopicSum;
var spRatio;
function setup() {
}
function draw() {
}
function log10 (x) {
  return (log(x) / log(10));
}

function buttonClicked(){
	illuminanceLevel = document.getElementById("illuminanceLevel").value;
	var spectrumChoice = document.getElementById("spectrumChoice").value;
	if(spectrumChoice=="mySpectrum"){
		userSpectrumText = document.getElementById("userSPDEnter").value;
		userSpectrum = csvJSON(userSpectrumText);
		}
	else if(spectrumChoice=="incandescent"){
		userSpectrum = incandescent;
	}
	else if(spectrumChoice=="daylight"){
		userSpectrum = daylight;
	}
	else if(spectrumChoice=="warmwhitefluorescent"){
		userSpectrum = warmwhitefluorescent;
	}
	else if(spectrumChoice=="hps"){
		userSpectrum = hps;
	}
	else if(spectrumChoice=="led2700"){
		userSpectrum=led2700;
	}
	else if(spectrumChoice=="led3000"){
		userSpectrum=led3000;
	}
	else if(spectrumChoice=="led4000"){
		userSpectrum=led4000;
	}
	else if(spectrumChoice=="led6800"){
		userSpectrum=led6800;
	}
	else if(spectrumChoice=="metalhalide"){
		userSpectrum=metalhalide;
	}
	SPcalculations = [
		[400,0.000396078,userSpectrum["400"]*0.000396078/1000*10,photopicEfficacy[0]*userSpectrum["400"]/1000,scotopicEfficacy[0]*userSpectrum["400"]/1000],
		[410,0.001210239,userSpectrum["410"]*0.001210239/1000*10,photopicEfficacy[1]*userSpectrum["410"]/1000,scotopicEfficacy[1]*userSpectrum["410"]/1000],
		[420,0.00400079,userSpectrum["420"]*0.00400079/1000*10,photopicEfficacy[2]*userSpectrum["420"]/1000,scotopicEfficacy[2]*userSpectrum["420"]/1000],
		[430,0.011602292,userSpectrum["430"]*0.011602292/1000*10,photopicEfficacy[3]*userSpectrum["430"]/1000,scotopicEfficacy[3]*userSpectrum["430"]/1000],
		[440,0.023004545,userSpectrum["440"]*0.023004545/1000*10,photopicEfficacy[4]*userSpectrum["440"]/1000,scotopicEfficacy[4]*userSpectrum["440"]/1000],
		[450,0.038007508,userSpectrum["450"]*0.038007508/1000*10,photopicEfficacy[5]*userSpectrum["450"]/1000,scotopicEfficacy[5]*userSpectrum["450"]/1000],
		[460,0.060011855,userSpectrum["460"]*0.060011855/1000*10,photopicEfficacy[6]*userSpectrum["460"]/1000,scotopicEfficacy[6]*userSpectrum["460"]/1000],
		[470,0.090997977,userSpectrum["470"]*0.090997977/1000*10,photopicEfficacy[7]*userSpectrum["470"]/1000,scotopicEfficacy[7]*userSpectrum["470"]/1000],
		[480,0.139047469,userSpectrum["480"]*0.139047469/1000*10,photopicEfficacy[8]*userSpectrum["480"]/1000,scotopicEfficacy[8]*userSpectrum["480"]/1000],
		[490,0.208061102,userSpectrum["490"]*0.208061102/1000*10,photopicEfficacy[9]*userSpectrum["490"]/1000,scotopicEfficacy[9]*userSpectrum["490"]/1000],
		[500,0.323063821,userSpectrum["500"]*0.323063821/1000*10,photopicEfficacy[10]*userSpectrum["500"]/1000,scotopicEfficacy[10]*userSpectrum["500"]/1000],
		[510,0.503099387,userSpectrum["510"]*0.503099387/1000*10,photopicEfficacy[11]*userSpectrum["510"]/1000,scotopicEfficacy[11]*userSpectrum["510"]/1000],
		[520,0.710140288,userSpectrum["520"]*0.710140288/1000*10,photopicEfficacy[12]*userSpectrum["520"]/1000,scotopicEfficacy[12]*userSpectrum["520"]/1000],
		[530,0.862170322,userSpectrum["530"]*0.862170322/1000*10,photopicEfficacy[13]*userSpectrum["530"]/1000,scotopicEfficacy[13]*userSpectrum["530"]/1000],
		[540,0.9541885,userSpectrum["540"]*0.9541885/1000*10,photopicEfficacy[14]*userSpectrum["540"]/1000,scotopicEfficacy[14]*userSpectrum["540"]/1000],
		[550,0.995146691,userSpectrum["550"]*0.995146691/1000*10,photopicEfficacy[15]*userSpectrum["550"]/1000,scotopicEfficacy[15]*userSpectrum["550"]/1000],
		[560,0.995196601,userSpectrum["560"]*0.995196601/1000*10,photopicEfficacy[16]*userSpectrum["560"]/1000,scotopicEfficacy[16]*userSpectrum["560"]/1000],
		[570,0.952188105,userSpectrum["570"]*0.952188105/1000*10,photopicEfficacy[17]*userSpectrum["570"]/1000,scotopicEfficacy[17]*userSpectrum["570"]/1000],
		[580,0.870171902,userSpectrum["580"]*0.870171902/1000*10,photopicEfficacy[18]*userSpectrum["580"]/1000,scotopicEfficacy[18]*userSpectrum["580"]/1000],
		[590,0.757149575,userSpectrum["590"]*0.757149575/1000*10,photopicEfficacy[19]*userSpectrum["590"]/1000,scotopicEfficacy[19]*userSpectrum["590"]/1000],
		[600,0.631124679,userSpectrum["600"]*0.631124679/1000*10,photopicEfficacy[20]*userSpectrum["600"]/1000,scotopicEfficacy[20]*userSpectrum["600"]/1000],
		[610,0.503099387,userSpectrum["610"]*0.503099387/1000*10,photopicEfficacy[21]*userSpectrum["610"]/1000,scotopicEfficacy[21]*userSpectrum["610"]/1000],
		[620,0.381075281,userSpectrum["620"]*0.381075281/1000*10,photopicEfficacy[22]*userSpectrum["620"]/1000,scotopicEfficacy[22]*userSpectrum["620"]/1000],
		[630,0.265052361,userSpectrum["630"]*0.265052361/1000*10,photopicEfficacy[23]*userSpectrum["630"]/1000,scotopicEfficacy[23]*userSpectrum["630"]/1000],
		[640,0.175034578,userSpectrum["640"]*0.175034578/1000*10,photopicEfficacy[24]*userSpectrum["640"]/1000,scotopicEfficacy[24]*userSpectrum["640"]/1000],
		[650,0.107021142,userSpectrum["650"]*0.107021142/1000*10,photopicEfficacy[25]*userSpectrum["650"]/1000,scotopicEfficacy[25]*userSpectrum["650"]/1000],
		[660,0.061012053,userSpectrum["660"]*0.061012053/1000*10,photopicEfficacy[26]*userSpectrum["660"]/1000,scotopicEfficacy[26]*userSpectrum["660"]/1000],
		[670,0.032006323,userSpectrum["670"]*0.032006323/1000*10,photopicEfficacy[27]*userSpectrum["670"]/1000,scotopicEfficacy[27]*userSpectrum["670"]/1000],
		[680,0.017003359,userSpectrum["680"]*0.017003359/1000*10,photopicEfficacy[28]*userSpectrum["680"]/1000,scotopicEfficacy[28]*userSpectrum["680"]/1000],
		[690,0.008211622,userSpectrum["690"]*0.008211622/1000*10,photopicEfficacy[29]*userSpectrum["690"]/1000,scotopicEfficacy[29]*userSpectrum["690"]/1000],
		[700,0.004102811,userSpectrum["700"]*0.004102811/1000*10,photopicEfficacy[30]*userSpectrum["700"]/1000,scotopicEfficacy[30]*userSpectrum["700"]/1000]
	];

	//3
	scotopicSum = 0;
	for (let i = 0; i < 31; i++) {
	  scotopicSum += SPcalculations[i][4];
	}
	photopicSum = 0;
	for (let i = 0; i < 31; i++) {
	  photopicSum += SPcalculations[i][3];
	}
	spRatio = scotopicSum/photopicSum;
	luminance = illuminanceLevel/PI;
	var logA =3.36-0.31*log(luminance*pow(spRatio,0.78)); 
	var A = exp(logA);
	BermanModel =sqrt(A/PI)*2;
	
	ReaOuelletteModifiedDeGroot = 4.77-2.44*tan(0.3*log10(luminance))
	document.getElementById("results").innerHTML = "Rea/Ouellette: "+ReaOuelletteModifiedDeGroot.toFixed(2)+"\n"+"Berman Model: "+BermanModel.toFixed(2);

	//pupil size interpolation
	var modelChoice = document.getElementById("modelChoice").value;
	if(modelChoice=="rea"){
		var pupilSize = ReaOuelletteModifiedDeGroot;
	}
	else if(modelChoice=="berman"){
		var pupilSize = BermanModel;
	}
	else if(modelChoice=="fixed"){
		var pupilSize = document.getElementById("fixedPupilDiameter").value;
	}
	
	var age = document.getElementById("age").value;
	var interpolation0 = [];
	var interpolation2 = [];
	var interpolation4 = [];
	var interpolation6 = [];
	var interpolation8 = [];
	if(age>=20&&age<40){
		for(i=0;i<twentyPupilSize0.length;i++){
			interpolation0.push(twentyPupilSize0[i]-(twentyPupilSize0[i]-fourtyPupilSize0[i])/20*(age-20));
			interpolation2.push(twentyPupilSize2[i]-(twentyPupilSize2[i]-fourtyPupilSize2[i])/20*(age-20));
			interpolation4.push(twentyPupilSize4[i]-(twentyPupilSize4[i]-fourtyPupilSize4[i])/20*(age-20));
			interpolation6.push(twentyPupilSize6[i]-(twentyPupilSize6[i]-fourtyPupilSize6[i])/20*(age-20));
			interpolation8.push(twentyPupilSize8[i]-(twentyPupilSize8[i]-fourtyPupilSize8[i])/20*(age-20));
		}
	}
	else if(age>=40&&age<60){
		for(i=0;i<twentyPupilSize0.length;i++){
			interpolation0.push(fourtyPupilSize0[i]-(fourtyPupilSize0[i]-sixtyPupilSize0[i])/20*(age-40));
			interpolation2.push(fourtyPupilSize2[i]-(fourtyPupilSize2[i]-sixtyPupilSize2[i])/20*(age-40));
			interpolation4.push(fourtyPupilSize4[i]-(fourtyPupilSize4[i]-sixtyPupilSize4[i])/20*(age-40));
			interpolation6.push(fourtyPupilSize6[i]-(fourtyPupilSize6[i]-sixtyPupilSize6[i])/20*(age-40));
			interpolation8.push(fourtyPupilSize8[i]-(fourtyPupilSize8[i]-sixtyPupilSize8[i])/20*(age-40));
		}
	}
	else if(age>=60&&age<80){
		for(i=0;i<twentyPupilSize0.length;i++){
			interpolation0.push(sixtyPupilSize0[i]-(sixtyPupilSize0[i]-eightyPupilSize0[i])/20*(age-60));
			interpolation2.push(sixtyPupilSize2[i]-(sixtyPupilSize2[i]-eightyPupilSize2[i])/20*(age-60));
			interpolation4.push(sixtyPupilSize4[i]-(sixtyPupilSize4[i]-eightyPupilSize4[i])/20*(age-60));
			interpolation6.push(sixtyPupilSize6[i]-(sixtyPupilSize6[i]-eightyPupilSize6[i])/20*(age-60));
			interpolation8.push(sixtyPupilSize8[i]-(sixtyPupilSize8[i]-eightyPupilSize8[i])/20*(age-60));
		}

	}
	else if(age>=80){
		for(i=0;i<twentyPupilSize0.length;i++){
			interpolation0.push(eightyPupilSize0[i]);
			interpolation2.push(eightyPupilSize2[i]);
			interpolation4.push(eightyPupilSize4[i]);
			interpolation6.push(eightyPupilSize6[i]);
			interpolation8.push(eightyPupilSize8[i]);
		}
	}

	var transmittancePer = [];
	if(pupilSize>=0&&pupilSize<2){
		for(i=0;i<interpolation0.length;i++){
			transmittancePer.push((interpolation0[i]+(interpolation2[i]-interpolation0[i])/2*(pupilSize-0))/100);
		}
	}
	else if(pupilSize>=2&&pupilSize<4){
		for(i=0;i<interpolation0.length;i++){
			transmittancePer.push((interpolation2[i]+(interpolation4[i]-interpolation2[i])/2*(pupilSize-0))/100);
		}
	}
	else if(pupilSize>=4&&pupilSize<6){
		for(i=0;i<interpolation0.length;i++){
			transmittancePer.push((interpolation4[i]+(interpolation6[i]-interpolation4[i])/2*(pupilSize-0))/100);
		}
	}
	else if(pupilSize>=6&&pupilSize<8){
		for(i=0;i<interpolation0.length;i++){
			transmittancePer.push((interpolation6[i]+(interpolation8[i]-interpolation6[i])/2*(pupilSize-0))/100);
		}
	}
	else if(pupilSize>=8){
		for(i=0;i<interpolation0.length;i++){
			transmittancePer.push(interpolation8[i]/100);
		}

	}

	wavelengthSpectrum = [400,410,420,430,440,450,460,470,480,490,500,510,520,530,540,550,560,570,580,590,600,610,620,630,640,650,660,670,680,690,700];
	var valuesSpectrumReachingEye = [userSpectrum["400"],userSpectrum["410"],userSpectrum["420"],userSpectrum["430"],userSpectrum["440"],userSpectrum["450"],userSpectrum["460"],userSpectrum["470"],userSpectrum["480"],userSpectrum["490"],userSpectrum["500"],userSpectrum["510"],userSpectrum["520"],userSpectrum["530"],userSpectrum["540"],userSpectrum["550"],userSpectrum["560"],userSpectrum["570"],userSpectrum["580"],userSpectrum["590"],userSpectrum["600"],userSpectrum["610"],userSpectrum["620"],userSpectrum["630"],userSpectrum["640"],userSpectrum["650"],userSpectrum["660"],userSpectrum["670"],userSpectrum["680"],userSpectrum["690"],userSpectrum["700"]];
	valuesSpectrumReachingRetina = valuesSpectrumReachingEye.map(function(x, index){
 		return transmittancePer[index] * x 
	});

	//CHARTS
	var ctx = document.getElementById('spectrumChart').getContext('2d');
	var spectrumChart = new Chart(ctx, {
	  type: 'line',
	  data: {
	    labels: wavelengthSpectrum,
	    datasets: [{
	      fill: false,
	      label: 'SPD Reaching the Eye',
	      data: valuesSpectrumReachingEye,
	      borderColor: "rgba(133, 180, 255,1)"
	    }, 
	    {
	      fill: false,
	      label: 'SPD Reaching the Retina',
	      data: valuesSpectrumReachingRetina,
	      borderColor: "rgba(20, 163, 55,1)"
	    }
	    ]
	  }
	});
	var lensSpec = [400,410,420,430,440,450,460,470,480,490,500,510,520,530,540,550,560,570,580,590,600,610,620,630,640,650,660,670,680,690,700];
	var ctx2 = document.getElementById('humanLensChart').getContext('2d');
	var humanLensChart = new Chart(ctx2, {
	  type: 'line',
	  data: {
	    labels: lensSpec,
	    datasets: [{
	      fill: false,
	      label: 'Human Lens Transmittance',
	      data: transmittancePer,
	      borderColor: "rgba(252, 186, 3,1)"
	    }
	    ]
	  }
	});
	 document.getElementById("buttonFriends").innerHTML = '<button onclick="printClicked()">Print Page</button><button onclick="exportRetinaSPD()">Export SPD Reaching Retina</button>';


}

function csvJSON(csv){
  var lines=csv.split("\n");
  var result = {};
  for(var i=0;i<lines.length;i++){
	var currentline=lines[i].split(",");
	result[currentline[0]] = parseFloat(currentline[1]);
  }
  return result;
}

function printClicked(){
	document.getElementById("buttonFriends").innerHTML = '';
	document.getElementById("textboxFriend").innerHTML = '';
	window.print();
	document.getElementById("buttonFriends").innerHTML = '<button onclick="printClicked()">Print Page</button><button onclick="exportRetinaSPD()">Export SPD Reaching Retina</button>';
	document.getElementById("textboxFriend").innerHTML ='<textarea id="userSPDEnter" cols="40" rows="10"></textarea><button onclick="buttonClicked()">Compute</button>';
}
function exportRetinaSPD(){
	var newRetArr = [["Wavelength (nm)","Power"]];
	var innerRetArr =[];
	for(var i=0;i<wavelengthSpectrum.length;i++){
		innerRetArr.push(wavelengthSpectrum[i]);
		innerRetArr.push(valuesSpectrumReachingRetina[i]);
		newRetArr.push(innerRetArr);
		innerRetArr = [];
	}


	let csvContent = "data:text/csv;charset=utf-8," 
    	+ newRetArr.map(e => e.join(",")).join("\n");
	var encodedUri = encodeURI(csvContent);
	var link = document.createElement("a");
	link.setAttribute("href", encodedUri);
	link.setAttribute("download", "spd_reaching_the_retina.csv");
	document.body.appendChild(link); 

	link.click();


}